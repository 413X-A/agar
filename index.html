<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agar.io Clone</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      background: #f0f0f0;
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const worldSize = 3;
    const gameWidth = canvas.width * worldSize;
    const gameHeight = canvas.height * worldSize;
    const foods = [];
    const bots = [];
    const splitSpeed = 8;

    class Entity {
      constructor(x, y, radius, color, isPlayer = false) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.isPlayer = isPlayer;
        this.vx = 0;
        this.vy = 0;
        this.score = Math.floor(radius);
        this.splitCooldown = 0;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.fillStyle = "#000";
        ctx.font = `${this.radius / 2}px Arial`;
        ctx.textAlign = "center";
        ctx.fillText(this.score, this.x, this.y + 5);
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.x = Math.max(this.radius, Math.min(gameWidth - this.radius, this.x));
        this.y = Math.max(this.radius, Math.min(gameHeight - this.radius, this.y));
      }
    }

    const player = new Entity(gameWidth / 2, gameHeight / 2, 30, "blue", true);
    const playerCells = [player];

    function spawnFood() {
      while (foods.length < 2500) {
        foods.push({
          x: Math.random() * gameWidth,
          y: Math.random() * gameHeight,
          radius: 3 + Math.random() * 2,
          color: "green"
        });
      }
    }

    function spawnBots(n) {
      for (let i = 0; i < n; i++) {
        bots.push(new Entity(
          Math.random() * gameWidth,
          Math.random() * gameHeight,
          15 + Math.random() * 20,
          "red"
        ));
      }
    }

    function eat(entity, target) {
      entity.radius = Math.sqrt(entity.radius ** 2 + target.radius ** 2);
      entity.score = Math.floor(entity.radius);
    }

    function split(entity, direction) {
      if (entity.radius < 10) return;
      const newRadius = entity.radius / Math.sqrt(2);
      const angle = Math.atan2(direction.y - entity.y, direction.x - entity.x);
      const vx = Math.cos(angle) * splitSpeed;
      const vy = Math.sin(angle) * splitSpeed;

      const newCell = new Entity(entity.x, entity.y, newRadius, entity.color, entity.isPlayer);
      newCell.vx = vx;
      newCell.vy = vy;
      if (entity.isPlayer) {
        playerCells.push(newCell);
      } else {
        bots.push(newCell);
      }

      entity.radius = newRadius;
      entity.score = Math.floor(entity.radius);
    }

    function gameLoop() {
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let camX = player.x - canvas.width / 2;
      let camY = player.y - canvas.height / 2;

      ctx.translate(-camX, -camY);

      // Draw boundary
      ctx.strokeStyle = "black";
      ctx.lineWidth = 10;
      ctx.strokeRect(0, 0, gameWidth, gameHeight);

      // Draw and update food
      for (let i = foods.length - 1; i >= 0; i--) {
        let food = foods[i];
        ctx.beginPath();
        ctx.arc(food.x, food.y, food.radius, 0, Math.PI * 2);
        ctx.fillStyle = food.color;
        ctx.fill();
      }

      // Player Movement
      const dx = mouse.x + camX - player.x;
      const dy = mouse.y + camY - player.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      if (distance > 1) {
        const speed = 2 / Math.sqrt(playerCells.length);
        player.vx = dx * speed / distance;
        player.vy = dy * speed / distance;
      }

      for (let i = playerCells.length - 1; i >= 0; i--) {
        let p = playerCells[i];
        p.update();
        p.draw();

        for (let j = foods.length - 1; j >= 0; j--) {
          let f = foods[j];
          let dist = Math.hypot(p.x - f.x, p.y - f.y);
          if (dist < p.radius) {
            eat(p, f);
            foods.splice(j, 1);
          }
        }
      }

      for (let i = bots.length - 1; i >= 0; i--) {
        let b = bots[i];

        // Find nearest food
        let nearestFood = null;
        let minDist = Infinity;
        for (let f of foods) {
          let d = Math.hypot(b.x - f.x, b.y - f.y);
          if (d < minDist) {
            minDist = d;
            nearestFood = f;
          }
        }

        // Find player or bot to chase or run from
        let target = null;
        let targetDist = Infinity;
        for (let e of [...playerCells, ...bots]) {
          if (e === b) continue;
          let d = Math.hypot(b.x - e.x, b.y - e.y);
          if (d < 300 && d < targetDist) {
            target = e;
            targetDist = d;
          }
        }

        if (target && b.radius > target.radius * 1.15 && targetDist < 100 && b.splitCooldown <= 0) {
          split(b, target);
          b.splitCooldown = 300;
        }

        if (target) {
          let dx = target.x - b.x;
          let dy = target.y - b.y;
          let d = Math.hypot(dx, dy);
          let factor = b.radius > target.radius ? 1 : -1;
          b.vx = dx / d * factor * 1.2;
          b.vy = dy / d * factor * 1.2;
        } else if (nearestFood) {
          let dx = nearestFood.x - b.x;
          let dy = nearestFood.y - b.y;
          let d = Math.hypot(dx, dy);
          b.vx = dx / d;
          b.vy = dy / d;
        }

        b.update();
        b.draw();

        for (let j = foods.length - 1; j >= 0; j--) {
          let f = foods[j];
          let dist = Math.hypot(b.x - f.x, b.y - f.y);
          if (dist < b.radius) {
            eat(b, f);
            foods.splice(j, 1);
          }
        }

        for (let j = playerCells.length - 1; j >= 0; j--) {
          let p = playerCells[j];
          let dist = Math.hypot(b.x - p.x, b.y - p.y);
          if (b.radius > p.radius * 1.15 && dist < b.radius * 0.75) {
            eat(b, p);
            playerCells.splice(j, 1);
          }
        }

        b.splitCooldown--;
      }

      spawnFood();

      requestAnimationFrame(gameLoop);
    }

    const mouse = { x: 0, y: 0 };
    canvas.addEventListener("mousemove", e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    window.addEventListener("keydown", e => {
      if (e.code === "Space") {
        playerCells.forEach(p => split(p, mouse));
      }
    });

    spawnFood();
    spawnBots(20);
    gameLoop();
  </script>
</body>
</html>
